<UserControl x:Class="Ludo.Views.GameView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:Ludo.Views"
             xmlns:vm="clr-namespace:LudoClient.ViewModels.InGameViewModels"
             mc:Ignorable="d"
             Height="800" Width="800"
             Loaded="UserControl_Loaded">

    <Grid Margin="0,111,0,0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="613*"/>
            <ColumnDefinition Width="187*"/>
        </Grid.ColumnDefinitions>

        <ItemsControl ItemsSource="{Binding BoardCells}" Grid.ColumnSpan="2" Margin="0,26,0,0">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="15" Columns="15"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="{Binding CellColor}" BorderBrush="Black" BorderThickness="0.1">
                        <ItemsControl ItemsSource="{Binding Pieces}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">

                                        <!-- Clickable piece -->
                                        <Button
                                            Command="{Binding DataContext.SelectPieceCommand,
                                                              RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                            CommandParameter="{Binding .}"
                                            Background="Transparent"
                                            BorderBrush="{x:Null}"
                                            Padding="0"
                                            Focusable="False">

                                            <Ellipse x:Name="Dot"
                                                     Width="{Binding VisualSize, FallbackValue=20}"
                                                     Height="{Binding VisualSize, FallbackValue=20}"
                                                     Fill="{Binding Fill}"
                                                     Stroke="Black"
                                                     StrokeThickness="1"/>
                                        </Button>
                                    </Grid>
                                    <!-- Visual highlight when selected -->
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                <Setter TargetName="Dot" Property="StrokeThickness" Value="3"/>
                                                <Setter TargetName="Dot" Property="Stroke" Value="Black"/>
                                                <Setter TargetName="Dot" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="Black"
                                                                          ShadowDepth="0"
                                                                          BlurRadius="10"
                                                                          Opacity="0.6"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>

                                   
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Save button -->
        <Button x:Name="SaveGameBtn"
                Content="Save Game"
                HorizontalAlignment="Left"
                Height="48"
                Margin="2,2,0,0"
                VerticalAlignment="Top"
                Width="80"
                Command="{Binding SaveGameCommand}"/>

        <!-- Ping UI -->
        <StackPanel Margin="130,-82,130,698" Grid.ColumnSpan="2">
            <Button Content="Send Ping" Command="{Binding PingCommand}" Width="100" Height="30"/>
            <Label Content="{Binding PingText}" FontSize="16" Margin="0,10,0,0"/>
        </StackPanel>

        <!-- Steps + Move controls -->
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Margin="100,2,0,0">
            <TextBlock Text="Steps:" Margin="0,6,6,0"/>
            <TextBox Width="60" Text="{Binding MoveSteps, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="Move"
                    Margin="8,0,0,0"
                    Command="{Binding MoveSelectedPieceCommand}"/>
        </StackPanel>

    </Grid>
</UserControl>
